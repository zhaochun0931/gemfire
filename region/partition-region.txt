start locator --name=locator1


start server --name=server1 --server-port=0 --enable-time-statistics=1 --statistic-archive-file=/tmp/server1.gfs --cache-xml-file=/root/gemfire/cache.xml
start server --name=server2 --server-port=0 --enable-time-statistics=1 --statistic-archive-file=/tmp/server2.gfs --cache-xml-file=/root/gemfire/cache.xml
start server --name=server3 --server-port=0 --enable-time-statistics=1 --statistic-archive-file=/tmp/server3.gfs --cache-xml-file=/root/gemfire/cache.xml


create region --name=exampleRegion1 --type=PARTITION_PERSISTENT --redundant-copies=1 --total-num-buckets=3
create region --name=exampleRegion2 --type=PARTITION_PERSISTENT --redundant-copies=2 --total-num-buckets=7




put --key=1  --value=hello1  --region=/exampleRegion1
put --key=2  --value=hello2  --region=/exampleRegion1
put --key=3  --value=hello3  --region=/exampleRegion1
put --key=4  --value=hello4  --region=/exampleRegion1
put --key=5  --value=hello5  --region=/exampleRegion1
put --key=6  --value=hello6  --region=/exampleRegion1
put --key=7  --value=hello7  --region=/exampleRegion1
put --key=8  --value=hello8  --region=/exampleRegion1
put --key=9  --value=hello9  --region=/exampleRegion1
put --key=10  --value=hello10  --region=/exampleRegion1




locate entry --key=1 --region=/exampleRegion1





put --key=1  --value=world1  --region=/exampleRegion2
put --key=2  --value=world2  --region=/exampleRegion2
put --key=3  --value=world3  --region=/exampleRegion2
put --key=4  --value=world4  --region=/exampleRegion2
put --key=5  --value=world5  --region=/exampleRegion2
put --key=6  --value=world6  --region=/exampleRegion2
put --key=7  --value=world7  --region=/exampleRegion2
put --key=8  --value=world8  --region=/exampleRegion2
put --key=9  --value=world9  --region=/exampleRegion2
put --key=10  --value=world10  --region=/exampleRegion2







shutdown --include-locators=yes


export offline-disk-store --name=ds1 --disk-dirs=/root/gemfire/server1/ds1 --dir=/tmp/backup/server1
export offline-disk-store --name=ds1 --disk-dirs=/root/gemfire/server2/ds1 --dir=/tmp/backup/server2
export offline-disk-store --name=ds1 --disk-dirs=/root/gemfire/server3/ds1 --dir=/tmp/backup/server3

export offline-disk-store --name=ds2 --disk-dirs=/root/gemfire/server1/ds2 --dir=/tmp/backup/server1
export offline-disk-store --name=ds2 --disk-dirs=/root/gemfire/server2/ds2 --dir=/tmp/backup/server2
export offline-disk-store --name=ds2 --disk-dirs=/root/gemfire/server3/ds2 --dir=/tmp/backup/server3








import data --member=server1 --region=/exampleRegion1 --file=/tmp/backup/server1/snapshot-ds1-exampleRegion1.gfd
import data --member=server1 --region=/exampleRegion1 --file=/tmp/backup/server2/snapshot-ds1-exampleRegion1.gfd
import data --member=server1 --region=/exampleRegion1 --file=/tmp/backup/server3/snapshot-ds1-exampleRegion1.gfd










for i in $(seq 100); do echo "put --key=$i --value=hello_$i --region=/exampleRegion1" >> region1.txt; done

for i in $(seq 200); do echo "put --key=$i --value=helloworld_$i --region=/exampleRegion2" >> region2.txt; done



gfsh run --file=region1.txt






query --query="select distinct p.bucketId as bucketId,p.bucketAdvisor.primary.equals(o) as isPrimary, o.name from (select * from /exampleRegion1.cache.rootRegions r where r.name='exampleRegion1') r, r.regionAdvisor.proxyBucketArray p, p.bucketOwners o order by bucketId,isPrimary desc limit 1000000"




gfsh>query --query="select distinct p.bucketId as bucketId,p.bucketAdvisor.primary.equals(o) as isPrimary, o.name from (select * from /exampleRegion1.cache.rootRegions r where r.name='exampleRegion1') r, r.regionAdvisor.proxyBucketArray p, p.bucketOwners o order by bucketId,isPrimary desc limit 1000000"
Result : true
Rows   : 339

bucketId | isPrimary | name
-------- | --------- | ----------
0        | true      | gf-server1
0        | false     | gf-server2
0        | false     | gf-server3
1        | true      | gf-server2
1        | false     | gf-server1
1        | false     | gf-server3
2        | true      | gf-server3
2        | false     | gf-server1
2        | false     | gf-server2
3        | true      | gf-server3
3        | false     | gf-server1
3        | false     | gf-server2
4        | true      | gf-server2
4        | false     | gf-server1
4        | false     | gf-server3
5        | true      | gf-server1
5        | false     | gf-server2
5        | false     | gf-server3
6        | true      | gf-server3
6        | false     | gf-server1
6        | false     | gf-server2
7        | true      | gf-server2
7        | false     | gf-server1
7        | false     | gf-server3
8        | true      | gf-server1
8        | false     | gf-server2
8        | false     | gf-server3
9        | true      | gf-server3
9        | false     | gf-server1
9        | false     | gf-server2
10       | true      | gf-server2
10       | false     | gf-server1
10       | false     | gf-server3
11       | true      | gf-server1
11       | false     | gf-server2
11       | false     | gf-server3
12       | true      | gf-server2
12       | false     | gf-server1
12       | false     | gf-server3
13       | true      | gf-server1
13       | false     | gf-server2
13       | false     | gf-server3
14       | true      | gf-server3
14       | false     | gf-server1
14       | false     | gf-server2
15       | true      | gf-server2
15       | false     | gf-server1
15       | false     | gf-server3
16       | true      | gf-server3
16       | false     | gf-server1
16       | false     | gf-server2
17       | true      | gf-server1
17       | false     | gf-server2
17       | false     | gf-server3
18       | true      | gf-server1
18       | false     | gf-server2
18       | false     | gf-server3
19       | true      | gf-server3
19       | false     | gf-server1
19       | false     | gf-server2
20       | true      | gf-server2
20       | false     | gf-server1
20       | false     | gf-server3
21       | true      | gf-server1
21       | false     | gf-server2
21       | false     | gf-server3
22       | true      | gf-server3
22       | false     | gf-server1
22       | false     | gf-server2
23       | true      | gf-server2
23       | false     | gf-server1
23       | false     | gf-server3
24       | true      | gf-server2
24       | false     | gf-server1
24       | false     | gf-server3
25       | true      | gf-server1
25       | false     | gf-server2
25       | false     | gf-server3
26       | true      | gf-server3
26       | false     | gf-server1
26       | false     | gf-server2
27       | true      | gf-server3
27       | false     | gf-server1
27       | false     | gf-server2
28       | true      | gf-server2
28       | false     | gf-server1
28       | false     | gf-server3
29       | true      | gf-server1
29       | false     | gf-server2
29       | false     | gf-server3
30       | true      | gf-server1
30       | false     | gf-server2
30       | false     | gf-server3
31       | true      | gf-server2
31       | false     | gf-server1
31       | false     | gf-server3
32       | true      | gf-server3
32       | false     | gf-server1
32       | false     | gf-server2
33       | true      | gf-server2
33       | false     | gf-server1
33       | false     | gf-server3
34       | true      | gf-server3
34       | false     | gf-server1
34       | false     | gf-server2
35       | true      | gf-server1
35       | false     | gf-server2
35       | false     | gf-server3
36       | true      | gf-server3
36       | false     | gf-server1
36       | false     | gf-server2
37       | true      | gf-server2
37       | false     | gf-server1
37       | false     | gf-server3
38       | true      | gf-server1
38       | false     | gf-server2
38       | false     | gf-server3
39       | true      | gf-server1
39       | false     | gf-server2
39       | false     | gf-server3
40       | true      | gf-server2
40       | false     | gf-server1
40       | false     | gf-server3
41       | true      | gf-server3
41       | false     | gf-server1
41       | false     | gf-server2
42       | true      | gf-server3
42       | false     | gf-server1
42       | false     | gf-server2
43       | true      | gf-server1
43       | false     | gf-server2
43       | false     | gf-server3
44       | true      | gf-server2
44       | false     | gf-server1
44       | false     | gf-server3
45       | true      | gf-server3
45       | false     | gf-server1
45       | false     | gf-server2
46       | true      | gf-server1
46       | false     | gf-server2
46       | false     | gf-server3
47       | true      | gf-server2
47       | false     | gf-server1
47       | false     | gf-server3
48       | true      | gf-server1
48       | false     | gf-server2
48       | false     | gf-server3
49       | true      | gf-server2
49       | false     | gf-server1
49       | false     | gf-server3
50       | true      | gf-server3
50       | false     | gf-server1
50       | false     | gf-server2
51       | true      | gf-server3
51       | false     | gf-server1
51       | false     | gf-server2
52       | true      | gf-server1
52       | false     | gf-server2
52       | false     | gf-server3
53       | true      | gf-server2
53       | false     | gf-server1
53       | false     | gf-server3
54       | true      | gf-server2
54       | false     | gf-server1
54       | false     | gf-server3
55       | true      | gf-server1
55       | false     | gf-server2
55       | false     | gf-server3
56       | true      | gf-server3
56       | false     | gf-server1
56       | false     | gf-server2
57       | true      | gf-server3
57       | false     | gf-server1
57       | false     | gf-server2
58       | true      | gf-server2
58       | false     | gf-server1
58       | false     | gf-server3
59       | true      | gf-server1
59       | false     | gf-server2
59       | false     | gf-server3
60       | true      | gf-server1
60       | false     | gf-server2
60       | false     | gf-server3
61       | true      | gf-server2
61       | false     | gf-server1
61       | false     | gf-server3
62       | true      | gf-server3
62       | false     | gf-server1
62       | false     | gf-server2
63       | true      | gf-server1
63       | false     | gf-server2
63       | false     | gf-server3
64       | true      | gf-server3
64       | false     | gf-server1
64       | false     | gf-server2
65       | true      | gf-server2
65       | false     | gf-server1
65       | false     | gf-server3
66       | true      | gf-server1
66       | false     | gf-server2
66       | false     | gf-server3
67       | true      | gf-server3
67       | false     | gf-server1
67       | false     | gf-server2
68       | true      | gf-server2
68       | false     | gf-server1
68       | false     | gf-server3
69       | true      | gf-server3
69       | false     | gf-server1
69       | false     | gf-server2
70       | true      | gf-server1
70       | false     | gf-server2
70       | false     | gf-server3
71       | true      | gf-server2
71       | false     | gf-server1
71       | false     | gf-server3
72       | true      | gf-server3
72       | false     | gf-server1
72       | false     | gf-server2
73       | true      | gf-server1
73       | false     | gf-server2
73       | false     | gf-server3
74       | true      | gf-server2
74       | false     | gf-server1
74       | false     | gf-server3
75       | true      | gf-server2
75       | false     | gf-server1
75       | false     | gf-server3
76       | true      | gf-server3
76       | false     | gf-server1
76       | false     | gf-server2
77       | true      | gf-server1
77       | false     | gf-server2
77       | false     | gf-server3
78       | true      | gf-server2
78       | false     | gf-server1
78       | false     | gf-server3
79       | true      | gf-server3
79       | false     | gf-server1
79       | false     | gf-server2
80       | true      | gf-server1
80       | false     | gf-server2
80       | false     | gf-server3
81       | true      | gf-server2
81       | false     | gf-server1
81       | false     | gf-server3
82       | true      | gf-server1
82       | false     | gf-server2
82       | false     | gf-server3
83       | true      | gf-server3
83       | false     | gf-server1
83       | false     | gf-server2
84       | true      | gf-server2
84       | false     | gf-server1
84       | false     | gf-server3
85       | true      | gf-server3
85       | false     | gf-server1
85       | false     | gf-server2
86       | true      | gf-server1
86       | false     | gf-server2
86       | false     | gf-server3
87       | true      | gf-server2
87       | false     | gf-server1
87       | false     | gf-server3
88       | true      | gf-server1
88       | false     | gf-server2
88       | false     | gf-server3
89       | true      | gf-server3
89       | false     | gf-server1
89       | false     | gf-server2
90       | true      | gf-server2
90       | false     | gf-server1
90       | false     | gf-server3
91       | true      | gf-server3
91       | false     | gf-server1
91       | false     | gf-server2
92       | true      | gf-server1
92       | false     | gf-server2
92       | false     | gf-server3
93       | true      | gf-server2
93       | false     | gf-server1
93       | false     | gf-server3
94       | true      | gf-server3
94       | false     | gf-server1
94       | false     | gf-server2
95       | true      | gf-server1
95       | false     | gf-server2
95       | false     | gf-server3
96       | true      | gf-server2
96       | false     | gf-server1
96       | false     | gf-server3
97       | true      | gf-server3
97       | false     | gf-server1
97       | false     | gf-server2
98       | true      | gf-server1
98       | false     | gf-server2
98       | false     | gf-server3
99       | true      | gf-server1
99       | false     | gf-server2
99       | false     | gf-server3
100      | true      | gf-server2
100      | false     | gf-server1
100      | false     | gf-server3
101      | true      | gf-server3
101      | false     | gf-server1
101      | false     | gf-server2
102      | true      | gf-server2
102      | false     | gf-server1
102      | false     | gf-server3
103      | true      | gf-server1
103      | false     | gf-server2
103      | false     | gf-server3
104      | true      | gf-server3
104      | false     | gf-server1
104      | false     | gf-server2
105      | true      | gf-server3
105      | false     | gf-server1
105      | false     | gf-server2
106      | true      | gf-server2
106      | false     | gf-server1
106      | false     | gf-server3
107      | true      | gf-server1
107      | false     | gf-server2
107      | false     | gf-server3
108      | true      | gf-server1
108      | false     | gf-server2
108      | false     | gf-server3
109      | true      | gf-server2
109      | false     | gf-server1
109      | false     | gf-server3
110      | true      | gf-server3
110      | false     | gf-server1
110      | false     | gf-server2
111      | true      | gf-server2
111      | false     | gf-server1
111      | false     | gf-server3
112      | true      | gf-server3
112      | false     | gf-server1
112      | false     | gf-server2

gfsh>














put --region=test1 --key=1 --value=hello1




locate entry --key=1 --region=/test1

query --query="select distinct p.bucketId as bucketId,p.bucketAdvisor.primary.equals(o) as isPrimary, o.name from (select * from /test1.cache.rootRegions r where r.name='test1') r, r.regionAdvisor.proxyBucketArray p, p.bucketOwners o order by bucketId,isPrimary desc limit 1000000"


# with redundancy zone
query --query="select distinct p.bucketId as bucketId,p.bucketAdvisor.primary.equals(o) as isPrimary,r.distributionManager.getRedundancyZone(o) as zone, o.name from (select * from /test1.cache.rootRegions r where r.name='test1') r, r.regionAdvisor.proxyBucketArray p, p.bucketOwners o order by bucketId,isPrimary desc, zone desc limit 1000000"












alter runtime --enable-statistics=yes --statistic-archive-file=server1.gfs




PARTITION_PERSISTENT


